<div id="chat-widget"></div>

<script>
  fetch("/chat-widget.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("chat-widget").innerHTML = html;

      // üî• NOW elements exist ‚Äî attach JS
      const toggleBtn = document.getElementById("chat-toggle");
      const chatBox = document.getElementById("chat-box");
      const form = document.getElementById("chat-form");
      const input = document.getElementById("message-input");
      const messages = document.getElementById("messages");

      // Toggle rocket
      toggleBtn.addEventListener("click", () => {
        chatBox.style.display =
          chatBox.style.display === "flex" ? "none" : "flex";
      });

      // Send message
      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const text = input.value.trim();
        if (!text) return;

        messages.innerHTML += `
          <div class="msg-user mb-2">
            <span>${text}</span>
          </div>
        `;
        input.value = "";
        messages.scrollTop = messages.scrollHeight;

        const res = await fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text }),
        });

        const data = await res.json();

        messages.innerHTML += `
          <div class="msg-bot mb-2">
            <span>${data.reply}</span>
          </div>
        `;
        messages.scrollTop = messages.scrollHeight;
      });
    });
</script>


<div class="container mt-4">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold">üìö Mental Health Resources</h3>
    <span class="text-muted">Curated reads & tools for you</span>
  </div>

  <div class="row g-4">

    <% resources.forEach(r => { %>
      <div class="col-lg-4 col-md-6">
        <div class="card h-100 shadow-sm border-0">

          <!-- Image -->
          <img
            src="<%= r.image %>"
            class="card-img-top"
            style="height: 180px; object-fit: cover;"
            alt="<%= r.title %>"
          >

          <div class="card-body d-flex flex-column">

            <!-- Tags -->
            <div class="mb-2">
              <span class="badge bg-light text-dark me-1">
                <%= r.type %>
              </span>
              <span class="badge bg-secondary">
                <%= r.category %>
              </span>
            </div>

            <!-- Title -->
            <h5 class="card-title mt-2">
              <%= r.title %>
            </h5>

            <!-- Description -->
            <p class="card-text text-muted small">
              <%= r.description %>
            </p>

            <!-- Meta -->
            <div class="d-flex justify-content-between text-muted small mt-auto">
              <span>‚è± <%= r.duration %></span>
              <span>üë§ <%= r.author %></span>
            </div>

            <!-- CTA -->
            <a
              href="<%= r.link %>"
              target="_blank"
              class="btn btn-outline-primary btn-sm mt-3 w-100"
            >
              Read More ‚Üó
            </a>

          </div>
        </div>
      </div>
    <% }) %>

  </div>
</div>
